import{f as p,k,R as H,V as se,d as P,K as re,bt as oe,S as ue,bD as de,b6 as ae,A as _,aZ as Y,aO as F,n as y,aL as ce,$ as q}from"./index-BQQ2VPbK.js";import{c as fe,d as j}from"./Follower-BII3ZYJ5.js";import{b as he}from"./next-frame-once-C5Ksf8W7.js";function U(t){return t&-t}class J{constructor(l,i){this.l=l,this.min=i;const r=new Array(l+1);for(let s=0;s<l+1;++s)r[s]=0;this.ft=r}add(l,i){if(i===0)return;const{l:r,ft:s}=this;for(l+=1;l<=r;)s[l]+=i,l+=U(l)}get(l){return this.sum(l+1)-this.sum(l)}sum(l){if(l===void 0&&(l=this.l),l<=0)return 0;const{ft:i,min:r,l:s}=this;if(l>s)throw new Error("[FinweckTree.sum]: `i` is larger than length.");let d=l*r;for(;l>0;)d+=i[l],l-=U(l);return d}getBound(l){let i=0,r=this.l;for(;r>i;){const s=Math.floor((i+r)/2),d=this.sum(s);if(d>l){r=s;continue}else if(d<l){if(i===s)return this.sum(i+1)<=l?i+1:s;i=s}else return s}return i}}let E;function me(){return typeof document>"u"?!1:(E===void 0&&("matchMedia"in window?E=window.matchMedia("(pointer:coarse)").matches:E=!1),E)}let D;function G(){return typeof document>"u"?1:(D===void 0&&(D="chrome"in window?window.devicePixelRatio:1),D)}const Q="VVirtualListXScroll";function ve({columnsRef:t,renderColRef:l,renderItemWithColsRef:i}){const r=p(0),s=p(0),d=k(()=>{const o=t.value;if(o.length===0)return null;const g=new J(o.length,0);return o.forEach((I,x)=>{g.add(x,I.width)}),g}),w=H(()=>{const o=d.value;return o!==null?Math.max(o.getBound(s.value)-1,0):0}),b=o=>{const g=d.value;return g!==null?g.sum(o):0},a=H(()=>{const o=d.value;return o!==null?Math.min(o.getBound(s.value+r.value)+1,t.value.length-1):0});return se(Q,{startIndexRef:w,endIndexRef:a,columnsRef:t,renderColRef:l,renderItemWithColsRef:i,getLeft:b}),{listWidthRef:r,scrollLeftRef:s}}const Z=P({name:"VirtualListRow",props:{index:{type:Number,required:!0},item:{type:Object,required:!0}},setup(){const{startIndexRef:t,endIndexRef:l,columnsRef:i,getLeft:r,renderColRef:s,renderItemWithColsRef:d}=re(Q);return{startIndex:t,endIndex:l,columns:i,renderCol:s,renderItemWithCols:d,getLeft:r}},render(){const{startIndex:t,endIndex:l,columns:i,renderCol:r,renderItemWithCols:s,getLeft:d,item:w}=this;if(s!=null)return s({itemIndex:this.index,startColIndex:t,endColIndex:l,allColumns:i,item:w,getLeft:d});if(r!=null){const b=[];for(let a=t;a<=l;++a){const o=i[a];b.push(r({column:o,left:d(a),item:w}))}return b}return null}}),ge=j(".v-vl",{maxHeight:"inherit",height:"100%",overflow:"auto",minWidth:"1px"},[j("&:not(.v-vl--show-scrollbar)",{scrollbarWidth:"none"},[j("&::-webkit-scrollbar, &::-webkit-scrollbar-track-piece, &::-webkit-scrollbar-thumb",{width:0,height:0,display:"none"})])]),Re=P({name:"VirtualList",inheritAttrs:!1,props:{showScrollbar:{type:Boolean,default:!0},columns:{type:Array,default:()=>[]},renderCol:Function,renderItemWithCols:Function,items:{type:Array,default:()=>[]},itemSize:{type:Number,required:!0},itemResizable:Boolean,itemsStyle:[String,Object],visibleItemsTag:{type:[String,Object],default:"div"},visibleItemsProps:Object,ignoreItemResize:Boolean,onScroll:Function,onWheel:Function,onResize:Function,defaultScrollKey:[Number,String],defaultScrollIndex:Number,keyField:{type:String,default:"key"},paddingTop:{type:[Number,String],default:0},paddingBottom:{type:[Number,String],default:0}},setup(t){const l=oe();ge.mount({id:"vueuc/virtual-list",head:!0,anchorMetaName:fe,ssr:l}),ue(()=>{const{defaultScrollIndex:e,defaultScrollKey:n}=t;e!=null?B({index:e}):n!=null&&B({key:n})});let i=!1,r=!1;de(()=>{if(i=!1,!r){r=!0;return}B({top:S.value,left:w.value})}),ae(()=>{i=!0,r||(r=!0)});const s=H(()=>{if(t.renderCol==null&&t.renderItemWithCols==null||t.columns.length===0)return;let e=0;return t.columns.forEach(n=>{e+=n.width}),e}),d=k(()=>{const e=new Map,{keyField:n}=t;return t.items.forEach((u,f)=>{e.set(u[n],f)}),e}),{scrollLeftRef:w,listWidthRef:b}=ve({columnsRef:_(t,"columns"),renderColRef:_(t,"renderCol"),renderItemWithColsRef:_(t,"renderItemWithCols")}),a=p(null),o=p(void 0),g=new Map,I=k(()=>{const{items:e,itemSize:n,keyField:u}=t,f=new J(e.length,n);return e.forEach((h,m)=>{const c=h[u],v=g.get(c);v!==void 0&&f.add(m,v)}),f}),x=p(0),S=p(0),W=H(()=>Math.max(I.value.getBound(S.value-Y(t.paddingTop))-1,0)),ee=k(()=>{const{value:e}=o;if(e===void 0)return[];const{items:n,itemSize:u}=t,f=W.value,h=Math.min(f+Math.ceil(e/u+1),n.length-1),m=[];for(let c=f;c<=h;++c)m.push(n[c]);return m}),B=(e,n)=>{if(typeof e=="number"){M(e,n,"auto");return}const{left:u,top:f,index:h,key:m,position:c,behavior:v,debounce:R=!0}=e;if(u!==void 0||f!==void 0)M(u,f,v);else if(h!==void 0)X(h,v,R);else if(m!==void 0){const A=d.value.get(m);A!==void 0&&X(A,v,R)}else c==="bottom"?M(0,Number.MAX_SAFE_INTEGER,v):c==="top"&&M(0,0,v)};let C,L=null;function X(e,n,u){const{value:f}=I,h=f.sum(e)+Y(t.paddingTop);if(!u)a.value.scrollTo({left:0,top:h,behavior:n});else{C=e,L!==null&&window.clearTimeout(L),L=window.setTimeout(()=>{C=void 0,L=null},16);const{scrollTop:m,offsetHeight:c}=a.value;if(h>m){const v=f.get(e);h+v<=m+c||a.value.scrollTo({left:0,top:h+v-c,behavior:n})}else a.value.scrollTo({left:0,top:h,behavior:n})}}function M(e,n,u){a.value.scrollTo({left:e,top:n,behavior:u})}function te(e,n){var u,f,h;if(i||t.ignoreItemResize||K(n.target))return;const{value:m}=I,c=d.value.get(e),v=m.get(c),R=(h=(f=(u=n.borderBoxSize)===null||u===void 0?void 0:u[0])===null||f===void 0?void 0:f.blockSize)!==null&&h!==void 0?h:n.contentRect.height;if(R===v)return;R-t.itemSize===0?g.delete(e):g.set(e,R-t.itemSize);const z=R-v;if(z===0)return;m.add(c,z);const T=a.value;if(T!=null){if(C===void 0){const O=m.sum(c);T.scrollTop>O&&T.scrollBy(0,z)}else if(c<C)T.scrollBy(0,z);else if(c===C){const O=m.sum(c);R+O>T.scrollTop+T.offsetHeight&&T.scrollBy(0,z)}N()}x.value++}const $=!me();let V=!1;function ne(e){var n;(n=t.onScroll)===null||n===void 0||n.call(t,e),(!$||!V)&&N()}function le(e){var n;if((n=t.onWheel)===null||n===void 0||n.call(t,e),$){const u=a.value;if(u!=null){if(e.deltaX===0&&(u.scrollTop===0&&e.deltaY<=0||u.scrollTop+u.offsetHeight>=u.scrollHeight&&e.deltaY>=0))return;e.preventDefault(),u.scrollTop+=e.deltaY/G(),u.scrollLeft+=e.deltaX/G(),N(),V=!0,he(()=>{V=!1})}}}function ie(e){if(i||K(e.target))return;if(t.renderCol==null&&t.renderItemWithCols==null){if(e.contentRect.height===o.value)return}else if(e.contentRect.height===o.value&&e.contentRect.width===b.value)return;o.value=e.contentRect.height,b.value=e.contentRect.width;const{onResize:n}=t;n!==void 0&&n(e)}function N(){const{value:e}=a;e!=null&&(S.value=e.scrollTop,w.value=e.scrollLeft)}function K(e){let n=e;for(;n!==null;){if(n.style.display==="none")return!0;n=n.parentElement}return!1}return{listHeight:o,listStyle:{overflow:"auto"},keyToIndex:d,itemsStyle:k(()=>{const{itemResizable:e}=t,n=F(I.value.sum());return x.value,[t.itemsStyle,{boxSizing:"content-box",width:F(s.value),height:e?"":n,minHeight:e?n:"",paddingTop:F(t.paddingTop),paddingBottom:F(t.paddingBottom)}]}),visibleItemsStyle:k(()=>(x.value,{transform:`translateY(${F(I.value.sum(W.value))})`})),viewportItems:ee,listElRef:a,itemsElRef:p(null),scrollTo:B,handleListResize:ie,handleListScroll:ne,handleListWheel:le,handleItemResize:te}},render(){const{itemResizable:t,keyField:l,keyToIndex:i,visibleItemsTag:r}=this;return y(q,{onResize:this.handleListResize},{default:()=>{var s,d;return y("div",ce(this.$attrs,{class:["v-vl",this.showScrollbar&&"v-vl--show-scrollbar"],onScroll:this.handleListScroll,onWheel:this.handleListWheel,ref:"listElRef"}),[this.items.length!==0?y("div",{ref:"itemsElRef",class:"v-vl-items",style:this.itemsStyle},[y(r,Object.assign({class:"v-vl-visible-items",style:this.visibleItemsStyle},this.visibleItemsProps),{default:()=>{const{renderCol:w,renderItemWithCols:b}=this;return this.viewportItems.map(a=>{const o=a[l],g=i.get(o),I=w!=null?y(Z,{index:g,item:a}):void 0,x=b!=null?y(Z,{index:g,item:a}):void 0,S=this.$slots.default({item:a,renderedCols:I,renderedItemWithCols:x,index:g})[0];return t?y(q,{key:o,onResize:W=>this.handleItemResize(o,W)},{default:()=>S}):(S.key=o,S)})}})]):(d=(s=this.$slots).empty)===null||d===void 0?void 0:d.call(s)])}})}}),ye=P({props:{onFocus:Function,onBlur:Function},setup(t){return()=>y("div",{style:"width: 0; height: 0",tabindex:0,onFocus:t.onFocus,onBlur:t.onBlur})}});export{ye as F,Re as V};
